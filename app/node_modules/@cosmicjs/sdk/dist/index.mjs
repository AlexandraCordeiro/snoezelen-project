var _=Object.defineProperty;var R=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var k=(e,t,n)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,P=(e,t)=>{for(var n in t||(t={}))B.call(t,n)&&k(e,n,t[n]);if(R)for(var n of R(t))I.call(t,n)&&k(e,n,t[n]);return e};var s=(e,t,n)=>new Promise((r,o)=>{var i=c=>{try{d(n.next(c))}catch(g){o(g)}},E=c=>{try{d(n.throw(c))}catch(g){o(g)}},d=c=>c.done?r(c.value):Promise.resolve(c.value).then(i,E);d((n=n.apply(e,t)).next())});var C={production:{v3:{apiUrl:"https://api.cosmicjs.com/v3",uploadUrl:"https://workers.cosmicjs.com/v3"}},staging:{v3:{apiUrl:"https://api.cosmic-staging.com/v3",uploadUrl:"https://workers.cosmic-staging.com/v3"}}},A=C;function v(e){if(e.custom){if(!e.custom.apiUrl||!e.custom.uploadUrl)throw new Error("apiUrl or uploadUrl is missing from 'custom' option");return{apiUrl:e.custom.apiUrl,uploadUrl:e.custom.uploadUrl}}if(!e.apiVersion||!["v3"].includes(e.apiVersion))throw new Error("apiVersion value can only be from 'v1', 'v2' & 'v3'");if(!e.apiEnvironment||!["production","staging"].includes(e.apiEnvironment))throw new Error("apiEnvironment value can only be from 'production' & 'staging'");return A[e.apiEnvironment][e.apiVersion]}import L from"form-data";var D={POST:"post",GET:"get",FETCH:"fetch",PUT:"put",PATCH:"patch",DELETE:"delete"},a=D;import q from"axios";var p=(e,t,n,r)=>q({method:e,url:t,data:n,headers:r}).then(i=>i.data).catch(i=>{throw i.response?i.response.data:i.response});function m(e){if(e&&e.trim())return{Authorization:`Bearer ${e}`};throw new Error("'writeKey' should be a valid string")}import F from"axios";var S=(e,t,n,r)=>F({method:e,url:t,data:n,headers:r});var W=e=>new Promise((t,n)=>{S(a.GET,e).then(r=>t(r.data)).catch(r=>n(r.response?r.response.data:r.response))}),l=(e,t,n)=>s(void 0,null,function*(){try{let r=yield W(e);n(r)}catch(r){if(t&&typeof t=="function")t(r);else throw r}});var u=class{constructor(t){this.endpoint="";this.endpoint=t}props(t){let n=t;return Array.isArray(n)&&(n=n.filter(r=>typeof r=="string").map(r=>r.trim()).filter(r=>!!r).toString()),this.endpoint+=`&props=${n}`,this}sort(t){return this.endpoint+=`&sort=${t}`,this}skip(t){return this.endpoint+=`&skip=${t}`,this}useCache(){return this.endpoint+="&use_cache=true",this}};var $=class extends u{limit(t){return this.endpoint+=`&limit=${t}`,this}then(t,n){return s(this,null,function*(){yield l(this.endpoint,n,r=>t==null?void 0:t(r))})}};var b=class extends u{then(t,n){return s(this,null,function*(){yield l(this.endpoint,n,r=>{let o=r.media&&r.media.length?r.media[0]:null;t==null||t({media:o})})})}};var h=e=>e?`&query=${encodeURIComponent(JSON.stringify(e))}`:"";var O,U=(e,t)=>({find(r){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/media?read_key=${e.readKey}${h(r)}`;return new $(o)},findOne(r){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/media?read_key=${e.readKey}&limit=1${h(r)}`;return new b(o)},insertOne(r){return s(this,null,function*(){let o=`${t.uploadUrl}/buckets/${e.bucketSlug}/media`,i=new L;return r.media.buffer?i.append("media",r.media.buffer,r.media.originalname):i.append("media",r.media,r.media.name),e.writeKey&&i.append("write_key",e.writeKey),r.folder&&i.append("folder",r.folder),r.metadata&&i.append("metadata",JSON.stringify(r.metadata)),r.trigger_webhook&&i.append("trigger_webhook",r.trigger_webhook.toString()),(d=>new Promise((c,g)=>{r.media.buffer?d.getLength((x,G)=>{x&&g(x);let M=P({"Content-Length":G},d.getHeaders());c(M)}):c({"Content-Type":"multipart/form-data"})}))(i).then(d=>{let c=d;return e.writeKey&&(c.Authorization=`Bearer ${e.writeKey}`),p(a.POST,o,i,c)}).catch(d=>{throw d.response.data})})},updateOne(r,o){return s(this,null,function*(){let i=`${t.apiUrl}/buckets/${e.bucketSlug}/media/${r}`;return O=m(e.writeKey),p(a.PATCH,i,o,O)})},deleteOne(r,o=!1){return s(this,null,function*(){let i=`${t.apiUrl}/buckets/${e.bucketSlug}/media/${r}${o?"?trigger_webhook=true":""}`;return O=m(e.writeKey),p(a.DELETE,i,null,O)})}});var y=class extends u{depth(t){return this.endpoint+=`&depth=${t}`,this}status(t){return this.endpoint+=`&status=${t}`,this}after(t){return this.endpoint+=`&after=${t}`,this}};var j=class extends y{limit(t){return this.endpoint+=`&limit=${t}`,this}then(t,n){return s(this,null,function*(){yield l(this.endpoint,n,r=>t==null?void 0:t(r))})}};var w=class extends y{then(t,n){return s(this,null,function*(){yield l(this.endpoint,n,r=>{t==null||t({object:r.objects&&r.objects.length?r.objects[0]:null})})})}};var f,H=(e,t)=>({find(r){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/objects?read_key=${e.readKey}${h(r)}`;return new j(o)},findOne(r){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/objects?read_key=${e.readKey}&limit=1${h(r)}`;return new w(o)},insertOne(r){return s(this,null,function*(){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/objects`;return f=m(e.writeKey),p(a.POST,o,r,f)})},updateOne(r,o){return s(this,null,function*(){let i=`${t.apiUrl}/buckets/${e.bucketSlug}/objects/${r}`;return f=m(e.writeKey),p(a.PATCH,i,o,f)})},deleteOne(r,o=!1){return s(this,null,function*(){let i=`${t.apiUrl}/buckets/${e.bucketSlug}/objects/${r}${o?"?trigger_webhook=true":""}`;return f=m(e.writeKey),p(a.DELETE,i,null,f)})}});var T,K=(e,t)=>({find(){let r=`${t.apiUrl}/buckets/${e.bucketSlug}/object-types?read_key=${e.readKey}`;return p(a.GET,r)},findOne(r){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/object-types/${r}?read_key=${e.readKey}`;return p(a.GET,o)},insertOne(r){return s(this,null,function*(){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/object-types`;return T=m(e.writeKey),p(a.POST,o,r,T)})},updateOne(r,o){return s(this,null,function*(){let i=`${t.apiUrl}/buckets/${e.bucketSlug}/object-types/${r}`;return T=m(e.writeKey),p(a.PATCH,i,o,T)})},deleteOne(r){return s(this,null,function*(){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/object-types/${r}`;return T=m(e.writeKey),p(a.DELETE,o,null,T)})}});var N=e=>{let t=P({apiVersion:"v3",apiEnvironment:"production"},e),n=v(t);return{objects:H(t,n),objectTypes:K(t,n),media:U(t,n)}},V=N;export{V as createBucketClient};
