"use strict";var L=Object.create;var $=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames,A=Object.getOwnPropertySymbols,z=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var v=(e,t,n)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,O=(e,t)=>{for(var n in t||(t={}))S.call(t,n)&&v(e,n,t[n]);if(A)for(var n of A(t))Q.call(t,n)&&v(e,n,t[n]);return e};var J=(e,t)=>{for(var n in t)$(e,n,{get:t[n],enumerable:!0})},U=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of V(t))!S.call(e,o)&&o!==n&&$(e,o,{get:()=>t[o],enumerable:!(r=N(t,o))||r.enumerable});return e};var x=(e,t,n)=>(n=e!=null?L(z(e)):{},U(t||!e||!e.__esModule?$(n,"default",{value:e,enumerable:!0}):n,e)),X=e=>U($({},"__esModule",{value:!0}),e);var s=(e,t,n)=>new Promise((r,o)=>{var i=c=>{try{d(n.next(c))}catch(g){o(g)}},R=c=>{try{d(n.throw(c))}catch(g){o(g)}},d=c=>c.done?r(c.value):Promise.resolve(c.value).then(i,R);d((n=n.apply(e,t)).next())});var re={};J(re,{createBucketClient:()=>q});module.exports=X(re);var Y={production:{v3:{apiUrl:"https://api.cosmicjs.com/v3",uploadUrl:"https://workers.cosmicjs.com/v3"}},staging:{v3:{apiUrl:"https://api.cosmic-staging.com/v3",uploadUrl:"https://workers.cosmic-staging.com/v3"}}},H=Y;function K(e){if(e.custom){if(!e.custom.apiUrl||!e.custom.uploadUrl)throw new Error("apiUrl or uploadUrl is missing from 'custom' option");return{apiUrl:e.custom.apiUrl,uploadUrl:e.custom.uploadUrl}}if(!e.apiVersion||!["v3"].includes(e.apiVersion))throw new Error("apiVersion value can only be from 'v1', 'v2' & 'v3'");if(!e.apiEnvironment||!["production","staging"].includes(e.apiEnvironment))throw new Error("apiEnvironment value can only be from 'production' & 'staging'");return H[e.apiEnvironment][e.apiVersion]}var B=x(require("form-data"));var Z={POST:"post",GET:"get",FETCH:"fetch",PUT:"put",PATCH:"patch",DELETE:"delete"},a=Z;var G=x(require("axios"));var p=(e,t,n,r)=>(0,G.default)({method:e,url:t,data:n,headers:r}).then(i=>i.data).catch(i=>{throw i.response?i.response.data:i.response});function m(e){if(e&&e.trim())return{Authorization:`Bearer ${e}`};throw new Error("'writeKey' should be a valid string")}var M=x(require("axios")),_=(e,t,n,r)=>(0,M.default)({method:e,url:t,data:n,headers:r});var ee=e=>new Promise((t,n)=>{_(a.GET,e).then(r=>t(r.data)).catch(r=>n(r.response?r.response.data:r.response))}),l=(e,t,n)=>s(void 0,null,function*(){try{let r=yield ee(e);n(r)}catch(r){if(t&&typeof t=="function")t(r);else throw r}});var u=class{constructor(t){this.endpoint="";this.endpoint=t}props(t){let n=t;return Array.isArray(n)&&(n=n.filter(r=>typeof r=="string").map(r=>r.trim()).filter(r=>!!r).toString()),this.endpoint+=`&props=${n}`,this}sort(t){return this.endpoint+=`&sort=${t}`,this}skip(t){return this.endpoint+=`&skip=${t}`,this}useCache(){return this.endpoint+="&use_cache=true",this}};var b=class extends u{limit(t){return this.endpoint+=`&limit=${t}`,this}then(t,n){return s(this,null,function*(){yield l(this.endpoint,n,r=>t==null?void 0:t(r))})}};var j=class extends u{then(t,n){return s(this,null,function*(){yield l(this.endpoint,n,r=>{let o=r.media&&r.media.length?r.media[0]:null;t==null||t({media:o})})})}};var h=e=>e?`&query=${encodeURIComponent(JSON.stringify(e))}`:"";var E,I=(e,t)=>({find(r){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/media?read_key=${e.readKey}${h(r)}`;return new b(o)},findOne(r){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/media?read_key=${e.readKey}&limit=1${h(r)}`;return new j(o)},insertOne(r){return s(this,null,function*(){let o=`${t.uploadUrl}/buckets/${e.bucketSlug}/media`,i=new B.default;return r.media.buffer?i.append("media",r.media.buffer,r.media.originalname):i.append("media",r.media,r.media.name),e.writeKey&&i.append("write_key",e.writeKey),r.folder&&i.append("folder",r.folder),r.metadata&&i.append("metadata",JSON.stringify(r.metadata)),r.trigger_webhook&&i.append("trigger_webhook",r.trigger_webhook.toString()),(d=>new Promise((c,g)=>{r.media.buffer?d.getLength((k,F)=>{k&&g(k);let W=O({"Content-Length":F},d.getHeaders());c(W)}):c({"Content-Type":"multipart/form-data"})}))(i).then(d=>{let c=d;return e.writeKey&&(c.Authorization=`Bearer ${e.writeKey}`),p(a.POST,o,i,c)}).catch(d=>{throw d.response.data})})},updateOne(r,o){return s(this,null,function*(){let i=`${t.apiUrl}/buckets/${e.bucketSlug}/media/${r}`;return E=m(e.writeKey),p(a.PATCH,i,o,E)})},deleteOne(r,o=!1){return s(this,null,function*(){let i=`${t.apiUrl}/buckets/${e.bucketSlug}/media/${r}${o?"?trigger_webhook=true":""}`;return E=m(e.writeKey),p(a.DELETE,i,null,E)})}});var y=class extends u{depth(t){return this.endpoint+=`&depth=${t}`,this}status(t){return this.endpoint+=`&status=${t}`,this}after(t){return this.endpoint+=`&after=${t}`,this}};var w=class extends y{limit(t){return this.endpoint+=`&limit=${t}`,this}then(t,n){return s(this,null,function*(){yield l(this.endpoint,n,r=>t==null?void 0:t(r))})}};var P=class extends y{then(t,n){return s(this,null,function*(){yield l(this.endpoint,n,r=>{t==null||t({object:r.objects&&r.objects.length?r.objects[0]:null})})})}};var f,C=(e,t)=>({find(r){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/objects?read_key=${e.readKey}${h(r)}`;return new w(o)},findOne(r){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/objects?read_key=${e.readKey}&limit=1${h(r)}`;return new P(o)},insertOne(r){return s(this,null,function*(){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/objects`;return f=m(e.writeKey),p(a.POST,o,r,f)})},updateOne(r,o){return s(this,null,function*(){let i=`${t.apiUrl}/buckets/${e.bucketSlug}/objects/${r}`;return f=m(e.writeKey),p(a.PATCH,i,o,f)})},deleteOne(r,o=!1){return s(this,null,function*(){let i=`${t.apiUrl}/buckets/${e.bucketSlug}/objects/${r}${o?"?trigger_webhook=true":""}`;return f=m(e.writeKey),p(a.DELETE,i,null,f)})}});var T,D=(e,t)=>({find(){let r=`${t.apiUrl}/buckets/${e.bucketSlug}/object-types?read_key=${e.readKey}`;return p(a.GET,r)},findOne(r){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/object-types/${r}?read_key=${e.readKey}`;return p(a.GET,o)},insertOne(r){return s(this,null,function*(){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/object-types`;return T=m(e.writeKey),p(a.POST,o,r,T)})},updateOne(r,o){return s(this,null,function*(){let i=`${t.apiUrl}/buckets/${e.bucketSlug}/object-types/${r}`;return T=m(e.writeKey),p(a.PATCH,i,o,T)})},deleteOne(r){return s(this,null,function*(){let o=`${t.apiUrl}/buckets/${e.bucketSlug}/object-types/${r}`;return T=m(e.writeKey),p(a.DELETE,o,null,T)})}});var te=e=>{let t=O({apiVersion:"v3",apiEnvironment:"production"},e),n=K(t);return{objects:C(t,n),objectTypes:D(t,n),media:I(t,n)}},q=te;0&&(module.exports={createBucketClient});
